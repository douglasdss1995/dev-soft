<!-- best-price.component.html - VERSÃO CORRIGIDA -->
<div class="m-3 d-flex flex-column justify-content-center align-items-center gap-2">

  <div class="d-flex flex-row gap-2">
    <!-- CORREÇÃO: campo nome do produto com bloqueio -->
    <mat-form-field>
      <mat-label>Produto</mat-label>
      <input
        matInput
        placeholder="Ex: Sabão em pó"
        [(ngModel)]="inputProductName"
        [readonly]="isNameLocked">
      <!-- CORREÇÃO: placeholder mais claro -->
    </mat-form-field>

    <!-- CORREÇÃO: campo quantidade multiplicadora com bloqueio -->
    <mat-form-field>
      <mat-label>Quantidade multiplicadora</mat-label>
      <input
        matInput
        type="number"
        placeholder="1000"
        [(ngModel)]="inputMultiplyQuantity"
        [readonly]="isNameLocked">
      <!-- CORREÇÃO: tipo number e placeholder correto -->
    </mat-form-field>
  </div>

  <!-- SUGESTÃO: adicionar campo anotação -->
  <div class="d-flex flex-row gap-2 w-100">
    <mat-form-field class="flex-grow-1">
      <mat-label>Anotação</mat-label>
      <input
        matInput
        placeholder="Ex: Supermercado ABC, promoção"
        [(ngModel)]="inputAnnotation">
    </mat-form-field>
  </div>

  <div class="d-flex flex-row gap-2">
    <!-- CORREÇÃO: tipo number e placeholder correto -->
    <mat-form-field>
      <mat-label>Preço (R$)</mat-label>
      <input
        matInput
        type="number"
        step="0.01"
        placeholder="0.00"
        [(ngModel)]="inputProductPrice">
    </mat-form-field>

    <!-- CORREÇÃO: tipo number e placeholder correto -->
    <mat-form-field>
      <mat-label>Quantidade na embalagem</mat-label>
      <input
        matInput
        type="number"
        step="0.01"
        placeholder="0.00"
        [(ngModel)]="inputProductQuantity">
    </mat-form-field>

    <!-- CORREÇÃO: desabilitar botão se campos obrigatórios estão vazios -->
    <button
      mat-fab
      extended
      (click)="addProduct()"
      [disabled]="!inputProductName || inputProductPrice <= 0 || inputProductQuantity <= 0">
      <mat-icon>add</mat-icon>
      Comparar
    </button>
  </div>

  <!-- CORREÇÃO: tabela completa com todas as colunas necessárias -->
  <div class="w-100" *ngIf="products.length > 0">
    <table mat-table [dataSource]="products" matSort class="mat-elevation-z8">

      <!-- NOVA: Coluna Anotação -->
      <ng-container matColumnDef="annotation">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Anotação</th>
        <td mat-cell *matCellDef="let element">{{ element.annotation || '-' }}</td>
      </ng-container>

      <!-- CORRIGIDA: Coluna Preço com formatação -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Preço Total</th>
        <td mat-cell *matCellDef="let element">
          {{ element.price | currency:'BRL':'symbol':'1.2-2' }}
        </td>
      </ng-container>

      <!-- CORRIGIDA: Coluna Quantidade com formatação -->
      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Quantidade</th>
        <td mat-cell *matCellDef="let element">
          {{ element.quantity | number:'1.2-2' }}
        </td>
      </ng-container>

      <!-- NOVA: Coluna Preço Unitário -->
      <ng-container matColumnDef="unitPrice">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Preço Unitário</th>
        <td mat-cell *matCellDef="let element">
          {{ getUnitPrice(element) | currency:'BRL':'symbol':'1.4-4' }}
        </td>
      </ng-container>

      <!-- NOVA: Coluna Preço Multiplicado -->
      <ng-container matColumnDef="multipliedPrice">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          Preço p/ {{ inputMultiplyQuantity }}
        </th>
        <td mat-cell *matCellDef="let element"
            [class.best-price]="isBestPrice(element)">
          <span class="price-value">
            {{ getMultipliedPrice(element) | currency:'BRL':'symbol':'1.2-2' }}
          </span>
          <mat-icon *ngIf="isBestPrice(element)" class="best-icon">star</mat-icon>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <!-- NOVO: Resumo da melhor opção -->
    <div class="mt-3" *ngIf="products.length > 1">
      <mat-divider></mat-divider>
      <div class="best-summary mt-2">
        <mat-icon color="primary">emoji_events</mat-icon>
        <span>Melhor preço: {{ getBestPrice() | currency:'BRL':'symbol':'1.2-2' }}</span>
      </div>
    </div>
  </div>
</div>
